# Система управления SSH-соединениями

Проект представляет собой систему управления SSH-соединениями, позволяющую выполнять различные операции с удаленными серверами по SSH протоколу.

## Описание

Эта система позволяет управлять SSH-соединениями с удаленными серверами. Она предоставляет возможность выполнения таких операций, как подключение к серверам, выполнение команд, загрузка файлов.

## Требования

- Java 8 или выше
- Maven
- Библиотеки, указанные в файле pom.xml (если не используете "fat-jar")

## Сборка .jar файлов 

Выполните команду:

```bash
    mvn clean package
```
После чего (если сборка прошла успешно) в директории в директории ./target 
появится два .jar файла:

- http.service-<version>.jar
- http.service-<version>-with-dependencies.jar.jar

## Запуск проекта

Для запуска проекта использует переменная окружения:

- `SERVER_PORT` - порт сервера PostgreSQL (по умолчанию `8080`).

Выполните команду:

```bash
    java -jar <имя .jar файла>
```

## RESTful API

Приложение предоставляет следующие эндпоинты для взаимодействия c программой:

### Создание SSH-подключения

Этот эндпоинт предназначен для создания нового SSH-подключения для указанного клиента.

HTTP метод: POST

Путь: /api/ssh/spark/server/clients

Параметры запроса:

    clientId (обязательный, тип: строка) - Идентификатор клиента.
    Тело запроса в формате JSON содержит следующие поля:
        host (тип: строка) - Хост, к которому будет осуществляться подключение по SSH.
        user (тип: строка) - Имя пользователя для аутентификации при подключении по SSH.
        port (тип: целое число, необязательный) - Порт, на котором ожидает соединений SSH-сервер (по умолчанию 22).
        password (тип: строка, необязательный) - Пароль для аутентификации при подключении по SSH (опциональный).
        keyFilePath (тип строкаб не обязательно) - путь до файла с ключом (Опционально).

Пример тела запроса:
```json
{
  "host": "example.com",
  "user": "username",
  "port": 22,
  "password": "secretPassword",
  "keyFilePath": "path/to/file"
}
```

Ответ:

    Код состояния 201 (Created) - SSH-подключение успешно создано.
    Код состояния 400 (Bad Request) - Некорректные входные данные.
    Код состояния 500 (Internal Server Error) - Ошибка сервера при создании SSH-подключения.

При успешном создании SSH-подключения, клиент с указанным идентификатором будет добавлен в список активных сессий.

### Удалить SSH соединение

Этот эндпоинт удаляет SSH соединение для указанного клиента.

HTTP метод: DELETE

Путь: /api/ssh/spark/server/clients/{clientId}

Параметры пути:

    clientId (тип: строка, обязательный) - Идентификатор клиента, для которого нужно удалить SSH соединение.

Ответ:

    Код состояния 204 (No Content) - SSH соединение успешно удалено.
    Код состояния 404 (Not Found) - SSH соединение для указанного клиента не найдено.
    Код состояния 500 (Internal Server Error) - Внутренняя ошибка сервера.

Пример успешного ответа:
Код состояния: 204 (No Content)

### Получение информации о клиенте по ID

Этот эндпоинт предназначен для получения информации о клиенте по его уникальному идентификатору.

HTTP метод: GET

Путь: /api/ssh/spark/server/clients/{clientId}

Параметры пути:

    clientId (обязательный, тип: строка) - Уникальный идентификатор клиента.

Ответ:

    Код состояния 200 (OK) - Информация о клиенте успешно получена.
        Тело ответа в формате JSON содержит следующие поля:
            clientId (тип: строка) - Уникальный идентификатор клиента.
            host (тип: строка) - Хост, к которому осуществляется подключение по SSH.
            user (тип: строка) - Имя пользователя для аутентификации при подключении по SSH.
            port (тип: целое число) - Порт, на котором ожидает соединений SSH-сервер.
            password (тип: строка, необязательное) - Пароль для аутентификации при подключении по SSH (если применимо).
            keyFilePath (тип строкаб не обязательно) - путь до файла с ключом.

    Код состояния 404 (Not Found) - Клиент с указанным ID не найден.

    Код состояния 500 (Internal Server Error) - Внутренняя ошибка сервера.

Пример успешного ответа:
```json
{
  "clientId": "123456",
  "host": "example.com",
  "user": "username",
  "port": 22,
  "password": "secretPassword",
  "keyFilePath": "path/to/file"
}
```

### Получение списка SSH соединений

Этот эндпоинт предназначен для получения списка всех активных SSH соединений.

HTTP метод: GET

Путь: /api/ssh/spark/server/clients

Ответ:

    Код состояния 200 (OK) - Список SSH соединений успешно получен.
        Тело ответа в формате JSON содержит массив объектов, каждый из которых представляет собой информацию о конкретном SSH соединении. Каждый объект имеет следующие поля:
            clientId (тип: строка) - Уникальный идентификатор клиента.
            host (тип: строка) - Хост, к которому осуществляется подключение по SSH.
            user (тип: строка) - Имя пользователя для аутентификации при подключении по SSH.
            port (тип: целое число) - Порт, на котором ожидает соединений SSH-сервер.
            password (тип: строка, необязательное) - Пароль для аутентификации при подключении по SSH (если применимо).
            keyFilePath (тип строкаб не обязательно) - путь до файла с ключом.

    Код состояния 500 (Internal Server Error) - Внутренняя ошибка сервера.

Пример успешного ответа: 
```json
[
  {
    "clientId": "123456",
    "host": "example.com",
    "user": "username",
    "port": 22,
    "password": "secretPassword"
  },
  {
    "clientId": "789012",
    "host": "example.org",
    "user": "anotherUser",
    "port": 2222
  }
]
```

### Проверка соединения

Этот эндпоинт предназначен для проверки соединения с SSH-клиентом по указанному идентификатору.

HTTP метод: GET

Путь: /api/ssh/spark/server/clients/{clientId}/check-connections

Параметры пути:

    clientId (обязательный) - Идентификатор клиента, для которого выполняется проверка соединения.

Ответ:

    Код состояния 200 (OK) - Соединение успешно проверено.
        Тело ответа в формате JSON содержит объект с одним полем:
            output (тип: строка) - Результат проверки соединения. Может содержать текстовое сообщение о состоянии соединения.

    Код состояния 404 (Not Found) - Клиент с указанным идентификатором не найден.
    Код состояния 500 (Internal Server Error) - Внутренняя ошибка сервера.

Пример успешного ответа:
```json
{
  "output": "123456 - successfully connected"
}
```

### Проверка соединений для всех клиентов

Этот эндпоинт позволяет проверить соединения для всех клиентов.

HTTP метод: GET

Путь: /api/ssh/spark/server/clients/check-connections

Ответ:

    Код состояния 200 (OK) - Список результатов проверки соединений успешно получен.
        Тело ответа в формате JSON содержит массив объектов, каждый из которых представляет результат проверки соединения для одного клиента. Каждый объект содержит одно поле:
            output (тип: строка) - Результат проверки соединения для клиента. Может содержать текстовое сообщение о состоянии соединения.

    Код состояния 500 (Internal Server Error) - Внутренняя ошибка сервера.

Пример успешного ответа:
```json
[
  {
    "output": "123456 - successfully connected"
  },
  {
    "output": "789012 - connection failed"
  }
]
```

### Выполнить команду на клиенте
Этот эндпоинт выполняет указанную команду на клиенте с заданным идентификатором.

HTTP метод: POST

Путь: /api/ssh/spark/server/clients/{clientId}/execute

Параметры пути:

    clientId (тип: строка, обязательный) - Идентификатор клиента, на котором нужно выполнить команду.

Тело запроса:

    CMDDto (тип: объект) - Данные команды для выполнения.
        cmd (тип: строка, обязательный) - Команда для выполнения.

Ответ:

    Код состояния 200 (OK) - Команда успешно выполнена.
    Код состояния 400 (Bad Request) - Некорректные входные данные.
    Код состояния 401 (Unauthorized) - Ошибка аутентификации.
    Код состояния 404 (Not Found) - Клиент с указанным ID не найден.
    Код состояния 500 (Internal Server Error) - Ошибка сервера при выполнении команды.
    Код состояния 502 (Bad Gateway) - Ошибка шлюза.

Пример запроса:
```json
{
  "cmd": "ls -l"
}
```

Пример успешного ответа:
Код состояния: 200 (OK)
```json
{
  "output": "результат выполнения команды"
}
```

### Записать JSON в файл
Этот эндпоинт записывает переданные JSON данные в файл на сервере для указанного клиента.

HTTP метод: POST

Путь: /api/ssh/spark/server/clients/{clientId}/write-json

Параметры пути:

    clientId (тип: строка, обязательный) - Идентификатор клиента, для которого нужно записать JSON в файл.

Параметры запроса:

    path (тип: строка, обязательный) - Путь к файлу, в который нужно записать JSON данные.

Тело запроса:

    json (тип: строка, обязательный) - JSON данные для записи в файл.

Ответ:

    Код состояния 201 (Created) - JSON успешно записан в файл.
    Код состояния 400 (Bad Request) - Некорректные входные данные.
    Код состояния 401 (Unauthorized) - Ошибка аутентификации.
    Код состояния 404 (Not Found) - Клиент с указанным ID не найден.
    Код состояния 500 (Internal Server Error) - Ошибка сервера при записи JSON в файл.
    Код состояния 502 (Bad Gateway) - Ошибка шлюза.
    Код состояния 503 (Service Unavailable) - Сервис недоступен: ошибка при попытке разрешения имени хоста.

Пример запроса: 
`POST /api/ssh/spark/server/clients/client123/write-json?path=/path/to/file.json`
```json
{
  "key": "value"
}
```

### Записать файл
Этот эндпоинт записывает переданный массив байтов в указанный файл для клиента с указанным ID.

HTTP метод: POST

Путь: /api/ssh/spark/server/clients/{clientId}/write-file

Параметры пути:

    clientId (тип: строка, обязательный) - Идентификатор клиента, для которого нужно записать файл.

Параметры запроса:

    path (тип: строка, обязательный) - Путь к файлу, в который нужно записать данные.

Тело запроса:

    Массив байтов (тип: byte[], обязательный) - Данные для записи в файл.

Ответ:

    Код состояния 201 (Created) - Файл успешно записан.
    Код состояния 400 (Bad Request) - Некорректные входные данные.
    Код состояния 401 (Unauthorized) - Ошибка аутентификации.
    Код состояния 404 (Not Found) - Клиент с указанным ID не найден.
    Код состояния 500 (Internal Server Error) - Ошибка сервера при записи файла.
    Код состояния 502 (Bad Gateway) - Ошибка шлюза.
    Код состояния 503 (Service Unavailable) - Сервис недоступен: ошибка при попытке разрешения имени хоста.

Пример запроса: 
`POST /api/ssh/spark/server/clients/client123/write-file?path=/path/to/file.txt`
```binary
<binary_data>
```

### Загрузить файл
Этот эндпоинт записывает переданный массив байтов в указанный файл для клиента с указанным ID.

HTTP метод: POST

Путь: /api/ssh/spark/server/clients/{clientId}/write-file

Параметры пути:

    clientId (тип: строка, обязательный) - Идентификатор клиента, для которого нужно записать файл.

Параметры запроса:

    path (тип: строка, обязательный) - Путь к файлу, в который нужно записать данные.

Тело запроса:

    Массив байтов (тип: byte[], обязательный) - Данные для записи в файл.

Ответ:

    Код состояния 201 (Created) - Файл успешно записан.
    Код состояния 400 (Bad Request) - Некорректные входные данные.
    Код состояния 401 (Unauthorized) - Ошибка аутентификации.
    Код состояния 404 (Not Found) - Клиент с указанным ID не найден.
    Код состояния 500 (Internal Server Error) - Ошибка сервера при записи файла.
    Код состояния 502 (Bad Gateway) - Ошибка шлюза.
    Код состояния 503 (Service Unavailable) - Сервис недоступен: ошибка при попытке разрешения имени хоста.

Пример запроса:
`POST /api/ssh/spark/server/clients/client123/upload-file?local_file_path=/path/to/local/file.txt&remote_file_path=/path/to/remote/file.txt
`

### Документация API с использованием Swagger

API-эндпоинты документированы с использованием Swagger, что делает процесс их изучения и использования более удобным. Вы можете получить полную документацию, используя Swagger UI.

**Swagger UI:** http://<host>:<Port>/swagger-ui/index.html#/

Для получения JSON-описания API, вы можете использовать следующую ссылку:

**JSON-описание API:** http://<host>:<port>/v2/api-docs
